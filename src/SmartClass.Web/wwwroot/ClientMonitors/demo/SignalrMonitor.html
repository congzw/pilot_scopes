
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>SignalrMonitor</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
</head>
<body>
    <div class="container" id="app">
        <h3>我的连接：{{message}}</h3>
        <div class="row">
            <div class="col-sm">
                One of three columns
            </div>
            <div class="col-sm">
                One of three columns
            </div>
            <div class="col-sm">
                One of three columns
            </div>
        </div>
        <hr />
        <div>
            <h3>连接模拟：</h3>
            <div>
                <form>
                    <div class="form-row">
                        <div class="col">
                            <!--<label for="scopeId">ScopeId</label>-->
                            <input type="text" class="form-control" v-model ="current.scopeId" id="scopeId" placeholder="ScopeId">
                        </div>
                        <div class="col">
                            <!--<label for="ClientId">ClientId</label>-->
                            <input type="text" class="form-control" v-model ="current.clientId" id="ClientId" placeholder="ClientId">
                        </div>
                        <div class="col">
                            <!--<label for="UserId">UserId</label>-->
                            <input type="text" class="form-control" v-model ="current.userId" id="UserId" placeholder="UserId">
                        </div>

                        <button type="button" @click="connectionHub(current.scopeId,current.clientId,current.userId)" class="btn btn-primary pull-right">进行连接</button>
                    </div>

                </form>
            </div>

        </div>
        <hr />
        <div class="row">
            <h3>连接列表：</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">clientId</th>
                        <th scope="col">scopeId</th>
                        <th scope="col">userId</th>
                        <th scope="col">connectionId</th>
                        <th scope="col">操作</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row">1</th>
                        <td>Mark</td>
                        <td>Otto</td>
                        <td>mdo</td>
                        <td>
                            <button type="button" @click="sendMessage">发送消息</button>
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">2</th>
                        <td>Jacob</td>
                        <td>Thornton</td>
                        <td>fatss</td>
                    </tr>
                    <tr>
                        <th scope="row">3</th>
                        <td>Larry</td>
                        <td>the Bird</td>
                        <td>twittersss</td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>
    <script src="/lib/vue.js" type="text/javascript"></script>
    <script src="/lib/signalr.js" type="text/javascript"></script>
    <script>
        var connection;
        var app = new Vue({
            el: '#app',
            data: {
                message: 'Hello Vue!',
                connections: [],
                current: {
                    scopeId: '',
                    clientId: '',
                    userId:''
                }
            },
            methods: {
                connectionHub: function (scopeId,clientId,userId) {
                    var hubName = "DemoHub";
                    var connectionHub = new signalR.HubConnectionBuilder()
                        .withUrl('/' + hubName + '?scopeId=' + scopeId + '&clientId=' + clientId + '&userId=' + userId)
                        .build();

                    var clientInvoke = "ClientInvoke";
                    connectionHub.on(clientInvoke, function (theArgs) {
                        console.log('callback: ' + clientInvoke, theArgs);
                        if (theArgs.method) {
                            _this[theArgs.method](theArgs.methodArgs);
                        }
                        //todo more
                    });

                    var clientStub = "ClientStub";
                    connectionHub.on(clientStub, function (theArgs) {
                        console.log('callback: ' + clientStub, theArgs);
                        if (theArgs.method) {
                            _this[theArgs.method](theArgs.methodArgs);
                        }
                        //todo more
                    });

                    connectionHub.start()
                        .then(function () {
                            console.log("与服务器连接成功");
                        })
                        .catch(error => {
                            console.error(error.message);
                        });
                },
                mockConnect: function () {
                    console.log(this.current)
                }
            },
            created() {
                var scopeId = "s1";
                var clientId = "c1";
                this.connectionHub(scopeId, clientId);
                //connection = new signalR.HubConnectionBuilder()
                //    .withUrl('/hbl/DemoHub?ScopeId=' + scopeId + '&ClientId=' + clientId, {}).build();

                //connection.start().then(function () {

                //    appendLi(clientId + "与服务器连接成功");
                //    console.log("与服务器连接成功！");
                //});
            }
        })
    </script>
</body>
</html>


